@using Blazored.SessionStorage
@using PeakyFlow.Aspire.Web.Components.Pages.Starter
@inherits LayoutComponentBase
@inject IJSRuntime JS
@inject ISessionStorageService SessionStorage
@inject DialogService DialogService

<RadzenComponents @rendermode="InteractiveServer" />
<div class="starter">
    <div class="starter-block">
        <div class="starter-details">
            <h1 class="name-app">Peaky Flow</h1>
            <div class="starter-img"></div>
            <RadzenButton Size="ButtonSize.Large"
                          Text="Play"
                          ButtonStyle="ButtonStyle.Primary"
                          class="btn-play"
                          Click="ScrollPage" />
        </div>
    </div>
</div>

<div class="page">
    <main>
        @Body
    </main>
</div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>

@code {

    protected override async Task OnAfterRenderAsync(bool isFirstRender)
    {
        var name = await SessionStorage.GetItemAsStringAsync("lobbyPlayerName");
        
        if (string.IsNullOrEmpty(name))
        {
            var dialogResult = await DialogService.OpenAsync<WhatIsYourNamePopupPage>("Welcome");
            if (dialogResult?.NameCreated ?? false)
            {
                await SessionStorage.SetItemAsStringAsync("lobbyPlayerName", dialogResult.Name);
            }
        }

        await JS.InvokeVoidAsync("scrollYByVh");
    }

    private async Task ScrollPage()
    {
        await JS.InvokeVoidAsync("scrollYByVh");
    }
}
