@page "/DialogJoinLobbyPage/{LobbyId}/{LobbyName}"
@using Blazored.SessionStorage
@using PeakyFlow.Aspire.Web.Components.Services

@inject DialogService DialogService
@inject ISessionStorageService SessionStorage
@inject JoinLobbyService JoinLobbyService

<RadzenStack Gap="1rem" Orientation="Orientation.Vertical" JustifyContent="JustifyContent.SpaceBetween" Style="height: 100%">
    <RadzenStack>
        <RadzenRow>
            <RadzenColumn Size="12" SizeMD="6" class="rz-p-4 rz-border-radius-1">
                <RadzenText TextStyle="TextStyle.Subtitle1">Game Name: @LobbyName</RadzenText>
             
            </RadzenColumn>
            <RadzenColumn>
                <RadzenText TextStyle="TextStyle.Subtitle2">Ready to join?</RadzenText>
            </RadzenColumn>
            <RadzenColumn Size="12" SizeMD="6" class="rz-p-4 rz-border-radius-1">
                <RadzenText TextStyle="TextStyle.Subtitle1">Your Name</RadzenText>
                <RadzenTextBox @bind-Value=@PlayerName Change=@((val) => PlayerName = val) />
            </RadzenColumn>
        </RadzenRow>
    </RadzenStack>
    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem">
        <RadzenButton Click=@JoinLobby Variant="Variant.Flat" Text="Join" Style="width: 120px" />
        <RadzenButton Click="@((args) => DialogService.Close(new CloseResult()))" Variant="Variant.Flat" Text="Close" Style="width: 120px" />
    </RadzenStack>

</RadzenStack>
@code {
    [Parameter]
    public string LobbyId { get; set; } = string.Empty;

    [Parameter]
    public string LobbyName { get; set; } = string.Empty;

    public string PlayerName { get; set; } = string.Empty;


    protected override async Task OnParametersSetAsync()
    {
        await base.OnParametersSetAsync();
        var name = await SessionStorage.GetItemAsStringAsync("lobbyPlayerName");

        if (!string.IsNullOrEmpty(name))
        {
            PlayerName = name;
        }
    }

    private async Task JoinLobby()
    {
        var resp = await JoinLobbyService.JoinLobby(LobbyId, PlayerName);
        DialogService.Close(new CloseResult(resp.Successfully));
    }

    public record CloseResult(bool IsJoined = false);

}